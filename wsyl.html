<!DOCTYPE html>
<html>
<head>
	<script src="papaparse.min.js" type="text/javascript"></script>
	<script src="math.js" type="text/javascript"></script>
	<style>
		.numinputcell {
			text-align: center;
		}
	</style>
</head>
<body>
	<form>
		<table style="width:20%">
			<tr>
				<th align="left">Month</th>
				<th>Temperature</th>
				<th>%Humidity</th>
			</tr>
			<tr>
				<td>January</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="janh"></td>
			</tr>
			<tr>
				<td>February</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="febh"></td>
			</tr>
			<tr>
				<td>March</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="marh"></td>
			</tr>
			<tr>
				<td>April</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="aprh"></td>
			</tr>
			<tr>
				<td>May</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="mayh"></td>
			</tr>
			<tr>
				<td>June</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="junh"></td>
			</tr>
			<tr>
				<td>July</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="julh"></td>
			</tr>
			<tr>
				<td>August</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="augh"></td>
			</tr>
			<tr>
				<td>September</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="seph"></td>
			</tr>
			<tr>
				<td>October</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="octh"></td>
			</tr>
			<tr>
				<td>November</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="novh"></td>
			</tr>
			<tr>
				<td>December</td>
				<td class="numinputcell"><input type="number" min="-459" max="212" step="0.1"></td>
				<td class="numinputcell"><input type="number" min="0" max="100" step="0.1" id="dech"></td>
			</tr>
		</table>
		<p><div>Which degree scale are your temperatures in?<br>
			<input type="radio" id="degreebuttonf" name="degreescale" value="fahrenheit" checked>
			<label for="degreebuttonf">Fahrenheit</label>
			<input type="radio" id="degreebuttonc" name="degreescale" value="celsius">
			<label for="degreebuttonc">Celsius</label>
		</div></p>
		<p><div>Which hemisphere are you in?<br>
			<input type="radio" id="hemispherebutton_n" name="whichhemisphere" value="nhemis" checked>
			<label for="hemispherebutton_n">Northern hemisphere (January is in the winter)</label><br>
			<input type="radio" id="hemispherebutton_s" name="whichhemisphere" value="shemis">
			<label for="hemispherebutton_s">Southern hemisphere (January is in the summer)</label>
		</div></p>
		<p>Optional: If you're unfamiliar with what a particular percentage humidity feels like, you can select from this list of presets: <select id="humiditypresets">
			<option value="own" selected>(I'm inputting my own humidity values)</option>
			<option value="yazd">Extreme desert</option>
			<option value="dubai">Arid</option>
			<option value="mongolia">Dry steppe</option>
			<option value="ukraine">Moderate steppe</option>
			<option value="med">Mediterranean</option>
			<option value="agadir">Fairly dry year-round</option>
			<option value="monsoon">Monsoon once per year</option>
			<option value="invertedsteppe">Dry winter, humid summer</option>
			<option value="colwood">Vancouver Island</option>
			<option value="atlanta">Humid year-round</option>
			<option value="rainforest">Rainforest</option>
		</select> (Note that only some of these work right now)<input type="button" value="Select preset"></p>
		<p><input type="button" value="Where should you live?"></p>
		<p id="weatherResult"></p>
		<p id="dump"></p>
	</form>
	<script type="text/javascript">
		var presetSelectButton = document.querySelectorAll('input[type="button"]')[0];
		var weatherTestButton = document.querySelectorAll('input[type="button"]')[1];

		presetSelectButton.onclick = function() {
			if (document.getElementById("humiditypresets").value === "yazd") {
				document.getElementById("janh").value = "45.6";
				document.getElementById("febh").value = "39.4";
				document.getElementById("marh").value = "29.8";
				document.getElementById("aprh").value = "24.4";
				document.getElementById("mayh").value = "21.4";
				document.getElementById("junh").value = "19";
				document.getElementById("julh").value = "20.4";
				document.getElementById("augh").value = "22.6";
				document.getElementById("seph").value = "24.8";
				document.getElementById("octh").value = "28.2";
				document.getElementById("novh").value = "38";
				document.getElementById("dech").value = "47.2";
			}
			else if (document.getElementById("humiditypresets").value === "dubai") {
				document.getElementById("janh").value = "63.4";
				document.getElementById("febh").value = "58.6";
				document.getElementById("marh").value = "52";
				document.getElementById("aprh").value = "46.2";
				document.getElementById("mayh").value = "43";
				document.getElementById("junh").value = "44";
				document.getElementById("julh").value = "45";
				document.getElementById("augh").value = "49";
				document.getElementById("seph").value = "54.2";
				document.getElementById("octh").value = "55.8";
				document.getElementById("novh").value = "60.6";
				document.getElementById("dech").value = "65";
			}
			else if (document.getElementById("humiditypresets").value === "mongolia") {
				document.getElementById("janh").value = "82.4";
				document.getElementById("febh").value = "78.8";
				document.getElementById("marh").value = "70";
				document.getElementById("aprh").value = "58";
				document.getElementById("mayh").value = "54.2";
				document.getElementById("junh").value = "50.6";
				document.getElementById("julh").value = "48.8";
				document.getElementById("augh").value = "51";
				document.getElementById("seph").value = "55.8";
				document.getElementById("octh").value = "66.6";
				document.getElementById("novh").value = "78";
				document.getElementById("dech").value = "83.2";
			}
			else if (document.getElementById("humiditypresets").value === "ukraine") {
				document.getElementById("janh").value = "83.8";
				document.getElementById("febh").value = "79.8";
				document.getElementById("marh").value = "73.6";
				document.getElementById("aprh").value = "65.2";
				document.getElementById("mayh").value = "64.4";
				document.getElementById("junh").value = "64.2";
				document.getElementById("julh").value = "62.2";
				document.getElementById("augh").value = "60.8";
				document.getElementById("seph").value = "66.8";
				document.getElementById("octh").value = "73.8";
				document.getElementById("novh").value = "81.4";
				document.getElementById("dech").value = "84.6";
			}
			else if (document.getElementById("humiditypresets").value === "med") {
				document.getElementById("janh").value = "72.4";
				document.getElementById("febh").value = "69";
				document.getElementById("marh").value = "63.4";
				document.getElementById("aprh").value = "59.2";
				document.getElementById("mayh").value = "55.4";
				document.getElementById("junh").value = "50.8";
				document.getElementById("julh").value = "47";
				document.getElementById("augh").value = "48.8";
				document.getElementById("seph").value = "55.6";
				document.getElementById("octh").value = "62.6";
				document.getElementById("novh").value = "70.8";
				document.getElementById("dech").value = "72.6";
			}
			else if (document.getElementById("humiditypresets").value === "colwood") {
				document.getElementById("janh").value = "90";
				document.getElementById("febh").value = "84.7";
				document.getElementById("marh").value = "80.2";
				document.getElementById("aprh").value = "73.3";
				document.getElementById("mayh").value = "69.5";
				document.getElementById("junh").value = "68.3";
				document.getElementById("julh").value = "65.2";
				document.getElementById("augh").value = "67.3";
				document.getElementById("seph").value = "73.5";
				document.getElementById("octh").value = "83.7";
				document.getElementById("novh").value = "88.5";
				document.getElementById("dech").value = "90.2";
			}
			else if (document.getElementById("humiditypresets").value === "rainforest") {
				document.getElementById("janh").value = "82.8";
				document.getElementById("febh").value = "82.4";
				document.getElementById("marh").value = "81.4";
				document.getElementById("aprh").value = "81.4";
				document.getElementById("mayh").value = "82.8";
				document.getElementById("junh").value = "84";
				document.getElementById("julh").value = "84.8";
				document.getElementById("augh").value = "86";
				document.getElementById("seph").value = "85.6";
				document.getElementById("octh").value = "85.2";
				document.getElementById("novh").value = "84.2";
				document.getElementById("dech").value = "83";
			}
		}

		weatherTestButton.onclick = function() {

			var farTempInputs = new Array(12);
			var celTempInputs = new Array(12);
			var tempInputs = new Array(12);

			var humidInputs = new Array(12);

			var hemisphereInput = null;

			for (i = 0; i < tempInputs.length; i++) {
				farTempInputs[i] = parseFloat(document.querySelectorAll('input[type="number"]')[2*i].value);
				celTempInputs[i] = ((parseFloat(document.querySelectorAll('input[type="number"]')[2*i].value) * (9 / 5)) + 32)

				humidInputs[i] = parseFloat(document.querySelectorAll('input[type="number"]')[(2*i)+1].value);
			}

			if (document.getElementById("degreebuttonc").checked === true) {
				tempInputs = celTempInputs;
			}
			else {
				tempInputs = farTempInputs;
			}

			if (document.getElementById("hemispherebutton_s").checked === true) {
				hemisphereInput = "S";
			}
			else {
				hemisphereInput = "N";
			}

			Papa.parse("weather_noprecip_full.csv", {
				header: true,
				dynamicTyping: true,
				download: true,
				delimiter: ",",
				complete: function(results) {
					var stations = results.data;
					var closest_station = null;

					var stationTemps = new Array(12);
					var comparisonTempArray = new Array(12);
					var stationHumids = new Array(12);
					var comparisonHumidArray = new Array(12);

					var tempNorm_overallBest = 9999999999;
					var tempNorm_current = tempNorm_overallBest
					var humidNorm_overallBest = tempNorm_overallBest;
					var humidNorm_current = tempNorm_overallBest;
					var overallNorm_overallBest = tempNorm_overallBest;

					var stationHemisphere = null;

					for (i = 0; i < stations.length; i++) {

						stationHemisphere = stations[i].lat_hemisphere;

						if (stationHemisphere === hemisphereInput) {
							stationTemps[0] = stations[i].jan_temp;
							stationTemps[1] = stations[i].feb_temp;
							stationTemps[2] = stations[i].mar_temp;
							stationTemps[3] = stations[i].apr_temp;
							stationTemps[4] = stations[i].may_temp;
							stationTemps[5] = stations[i].jun_temp;
							stationTemps[6] = stations[i].jul_temp;
							stationTemps[7] = stations[i].aug_temp;
							stationTemps[8] = stations[i].sep_temp;
							stationTemps[9] = stations[i].oct_temp;
							stationTemps[10] = stations[i].nov_temp;
							stationTemps[11] = stations[i].dec_temp;

							stationHumids[0] = stations[i].jan_humid;
							stationHumids[1] = stations[i].feb_humid;
							stationHumids[2] = stations[i].mar_humid;
							stationHumids[3] = stations[i].apr_humid;
							stationHumids[4] = stations[i].may_humid;
							stationHumids[5] = stations[i].jun_humid;
							stationHumids[6] = stations[i].jul_humid;
							stationHumids[7] = stations[i].aug_humid;
							stationHumids[8] = stations[i].sep_humid;
							stationHumids[9] = stations[i].oct_humid;
							stationHumids[10] = stations[i].nov_humid;
							stationHumids[11] = stations[i].dec_humid;
						}
						else {
							stationTemps[0] = stations[i].jul_temp;
							stationTemps[1] = stations[i].aug_temp;
							stationTemps[2] = stations[i].sep_temp;
							stationTemps[3] = stations[i].oct_temp;
							stationTemps[4] = stations[i].nov_temp;
							stationTemps[5] = stations[i].dec_temp;
							stationTemps[6] = stations[i].jan_temp;
							stationTemps[7] = stations[i].feb_temp;
							stationTemps[8] = stations[i].mar_temp;
							stationTemps[9] = stations[i].apr_temp;
							stationTemps[10] = stations[i].may_temp;
							stationTemps[11] = stations[i].jun_temp;

							stationHumids[0] = stations[i].jul_humid;
							stationHumids[1] = stations[i].aug_humid;
							stationHumids[2] = stations[i].sep_humid;
							stationHumids[3] = stations[i].oct_humid;
							stationHumids[4] = stations[i].nov_humid;
							stationHumids[5] = stations[i].dec_humid;
							stationHumids[6] = stations[i].jan_humid;
							stationHumids[7] = stations[i].feb_humid;
							stationHumids[8] = stations[i].mar_humid;
							stationHumids[9] = stations[i].apr_humid;
							stationHumids[10] = stations[i].may_humid;
							stationHumids[11] = stations[i].jun_humid;
						}

						for (j = 0; j < stationTemps.length; j++) {
							comparisonTempArray[j] = tempInputs[j] - stationTemps[j];
							comparisonHumidArray[j] = humidInputs[j] - stationHumids[j];
						}

						tempNorm_current = math.norm(comparisonTempArray);
						humidNorm_current = math.norm(comparisonHumidArray);
						var comparisonOverallArray = [tempNorm_current, humidNorm_current];

						if (math.norm(comparisonOverallArray) < overallNorm_overallBest) {
							overallNorm_overallBest = math.norm(comparisonOverallArray);
							tempNorm_overallBest = tempNorm_current;
							humidNorm_overallBest = humidNorm_current;
							closest_station = stations[i].city_nominal.concat(", ",stations[i].country," (difference scores ",math.round(tempNorm_overallBest,3)," temperature, ",math.round(humidNorm_overallBest,3)," humidity)");
						}
					}

					if (closest_station === null) {
						closest_station = "Make sure you fill in all of the input boxes"
					}

					document.getElementById("weatherResult").innerHTML = closest_station;
				}
			})
		}
	</script>
</body>
</html>